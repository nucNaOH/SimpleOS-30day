     1 00000000                                 [FORMAT "WCOFF"]
     2 00000000                                 [INSTRSET "i486p"]
     3 00000000                                 [OPTIMIZE 1]
     4 00000000                                 [OPTION 1]
     5 00000000                                 [BITS 32]
     6 00000000                                 	EXTERN	_init_gdtidt
     7 00000000                                 	EXTERN	_init_pic
     8 00000000                                 	EXTERN	_io_sti
     9 00000000                                 	EXTERN	_keyfifo
    10 00000000                                 	EXTERN	_fifo8_init
    11 00000000                                 	EXTERN	_mousefifo
    12 00000000                                 	EXTERN	_io_out8
    13 00000000                                 	EXTERN	_init_keyboard
    14 00000000                                 	EXTERN	_init_palette
    15 00000000                                 	EXTERN	_init_screen8
    16 00000000                                 	EXTERN	_putfonts8_asc
    17 00000000                                 	EXTERN	_sprintf
    18 00000000                                 	EXTERN	_memtest_sub
    19 00000000                                 	EXTERN	_memman_init
    20 00000000                                 	EXTERN	_memman_free
    21 00000000                                 	EXTERN	_memman_total
    22 00000000                                 	EXTERN	_init_mouse_cursor8
    23 00000000                                 	EXTERN	_putblock8_8
    24 00000000                                 	EXTERN	_enable_mouse
    25 00000000                                 	EXTERN	_io_cli
    26 00000000                                 	EXTERN	_fifo8_status
    27 00000000                                 	EXTERN	_fifo8_get
    28 00000000                                 	EXTERN	_mouse_decode
    29 00000000                                 	EXTERN	_boxfill8
    30 00000000                                 	EXTERN	_io_stihlt
    31 00000000                                 [FILE "bootpack.c"]
    32                                          [SECTION .data]
    33 00000000                                 LC0:
    34 00000000 66 79 74 2C 20 49 20 6C 6F 76   	DB	"fyt, I love you~",0x00
       0000000A 65 20 79 6F 75 7E 00 
    35 00000011                                 LC1:
    36 00000011 73 63 72 6E 78 20 3D 20 25 64   	DB	"scrnx = %d, scrny = %d",0x00
       0000001B 2C 20 73 63 72 6E 79 20 3D 20 
       00000025 25 64 00 
    37 00000028                                 LC2:
    38 00000028 4D 65 6D 6F 72 79 20 25 64 4D   	DB	"Memory %dMB; free: %dKB.",0x00
       00000032 42 3B 20 66 72 65 65 3A 20 25 
       0000003C 64 4B 42 2E 00 
    39 00000041                                 LC3:
    40 00000041 28 25 64 2C 25 64 29 00         	DB	"(%d,%d)",0x00
    41 00000049                                 LC5:
    42 00000049 5B 6C 63 72 20 25 34 64 20 25   	DB	"[lcr %4d %4d]",0x00
       00000053 34 64 5D 00 
    43 00000057                                 LC6:
    44 00000057 28 25 33 64 2C 20 25 33 64 29   	DB	"(%3d, %3d)",0x00
       00000061 00 
    45 00000062                                 LC4:
    46 00000062 25 30 32 78 00                  	DB	"%02x",0x00
    47                                          [SECTION .text]
    48 00000000                                 	GLOBAL	_HariMain
    49 00000000                                 _HariMain:
    50 00000000 55                              	PUSH	EBP
    51 00000001 89 E5                           	MOV	EBP,ESP
    52 00000003 57                              	PUSH	EDI
    53 00000004 56                              	PUSH	ESI
    54 00000005 53                              	PUSH	EBX
    55 00000006 81 EC 000001E4                  	SUB	ESP,484
    56 0000000C E8 [00000000]                   	CALL	_init_gdtidt
    57 00000011 E8 [00000000]                   	CALL	_init_pic
    58 00000016 E8 [00000000]                   	CALL	_io_sti
    59 0000001B 8D 85 FFFFFEA4                  	LEA	EAX,DWORD [-348+EBP]
    60 00000021 50                              	PUSH	EAX
    61 00000022 6A 20                           	PUSH	32
    62 00000024 68 [00000000]                   	PUSH	_keyfifo
    63 00000029 E8 [00000000]                   	CALL	_fifo8_init
    64 0000002E 8D 85 FFFFFE24                  	LEA	EAX,DWORD [-476+EBP]
    65 00000034 50                              	PUSH	EAX
    66 00000035 68 00000080                     	PUSH	128
    67 0000003A 68 [00000000]                   	PUSH	_mousefifo
    68 0000003F E8 [00000000]                   	CALL	_fifo8_init
    69 00000044 68 000000F9                     	PUSH	249
    70 00000049 6A 21                           	PUSH	33
    71 0000004B E8 [00000000]                   	CALL	_io_out8
    72 00000050 83 C4 20                        	ADD	ESP,32
    73 00000053 68 000000EF                     	PUSH	239
    74 00000058 68 000000A1                     	PUSH	161
    75 0000005D E8 [00000000]                   	CALL	_io_out8
    76 00000062 E8 [00000000]                   	CALL	_init_keyboard
    77 00000067 E8 [00000000]                   	CALL	_init_palette
    78 0000006C 0F BF 05 00000FF6               	MOVSX	EAX,WORD [4086]
    79 00000073 50                              	PUSH	EAX
    80 00000074 0F BF 05 00000FF4               	MOVSX	EAX,WORD [4084]
    81 0000007B 50                              	PUSH	EAX
    82 0000007C FF 35 00000FF8                  	PUSH	DWORD [4088]
    83 00000082 E8 [00000000]                   	CALL	_init_screen8
    84 00000087 68 [00000000]                   	PUSH	LC0
    85 0000008C 6A 02                           	PUSH	2
    86 0000008E 6A 6C                           	PUSH	108
    87 00000090 6A 6C                           	PUSH	108
    88 00000092 0F BF 05 00000FF4               	MOVSX	EAX,WORD [4084]
    89 00000099 50                              	PUSH	EAX
    90 0000009A FF 35 00000FF8                  	PUSH	DWORD [4088]
    91 000000A0 E8 [00000000]                   	CALL	_putfonts8_asc
    92 000000A5 83 C4 2C                        	ADD	ESP,44
    93 000000A8 0F BF 05 00000FF6               	MOVSX	EAX,WORD [4086]
    94 000000AF 50                              	PUSH	EAX
    95 000000B0 0F BF 05 00000FF4               	MOVSX	EAX,WORD [4084]
    96 000000B7 50                              	PUSH	EAX
    97 000000B8 8D 45 C4                        	LEA	EAX,DWORD [-60+EBP]
    98 000000BB 68 [00000011]                   	PUSH	LC1
    99 000000C0 50                              	PUSH	EAX
   100 000000C1 E8 [00000000]                   	CALL	_sprintf
   101 000000C6 68 BFFFFFFF                     	PUSH	-1073741825
   102 000000CB 68 00400000                     	PUSH	4194304
   103 000000D0 E8 [00000000]                   	CALL	_memtest_sub
   104 000000D5 68 003C0000                     	PUSH	3932160
   105 000000DA 89 C3                           	MOV	EBX,EAX
   106 000000DC E8 [00000000]                   	CALL	_memman_init
   107 000000E1 68 0009E000                     	PUSH	647168
   108 000000E6 68 00001000                     	PUSH	4096
   109 000000EB 68 003C0000                     	PUSH	3932160
   110 000000F0 E8 [00000000]                   	CALL	_memman_free
   111 000000F5 8D 83 FFC00000                  	LEA	EAX,DWORD [-4194304+EBX]
   112 000000FB C1 EB 14                        	SHR	EBX,20
   113 000000FE 83 C4 28                        	ADD	ESP,40
   114 00000101 50                              	PUSH	EAX
   115 00000102 68 00400000                     	PUSH	4194304
   116 00000107 68 003C0000                     	PUSH	3932160
   117 0000010C E8 [00000000]                   	CALL	_memman_free
   118 00000111 68 003C0000                     	PUSH	3932160
   119 00000116 E8 [00000000]                   	CALL	_memman_total
   120 0000011B 8D 55 C4                        	LEA	EDX,DWORD [-60+EBP]
   121 0000011E C1 E8 0A                        	SHR	EAX,10
   122 00000121 89 04 24                        	MOV	DWORD [ESP],EAX
   123 00000124 53                              	PUSH	EBX
   124 00000125 68 [00000028]                   	PUSH	LC2
   125 0000012A 8D 5D C4                        	LEA	EBX,DWORD [-60+EBP]
   126 0000012D 52                              	PUSH	EDX
   127 0000012E E8 [00000000]                   	CALL	_sprintf
   128 00000133 53                              	PUSH	EBX
   129 00000134 6A 07                           	PUSH	7
   130 00000136 BB 00000002                     	MOV	EBX,2
   131 0000013B 6A 40                           	PUSH	64
   132 0000013D 6A 00                           	PUSH	0
   133 0000013F 0F BF 05 00000FF4               	MOVSX	EAX,WORD [4084]
   134 00000146 50                              	PUSH	EAX
   135 00000147 FF 35 00000FF8                  	PUSH	DWORD [4088]
   136 0000014D E8 [00000000]                   	CALL	_putfonts8_asc
   137 00000152 83 C4 34                        	ADD	ESP,52
   138 00000155 0F BF 05 00000FF4               	MOVSX	EAX,WORD [4084]
   139 0000015C 8D 48 F0                        	LEA	ECX,DWORD [-16+EAX]
   140 0000015F 89 C8                           	MOV	EAX,ECX
   141 00000161 99                              	CDQ
   142 00000162 F7 FB                           	IDIV	EBX
   143 00000164 89 C6                           	MOV	ESI,EAX
   144 00000166 0F BF 05 00000FF6               	MOVSX	EAX,WORD [4086]
   145 0000016D 6A 0E                           	PUSH	14
   146 0000016F 8D 48 D4                        	LEA	ECX,DWORD [-44+EAX]
   147 00000172 89 C8                           	MOV	EAX,ECX
   148 00000174 99                              	CDQ
   149 00000175 F7 FB                           	IDIV	EBX
   150 00000177 8D 9D FFFFFEC4                  	LEA	EBX,DWORD [-316+EBP]
   151 0000017D 89 C7                           	MOV	EDI,EAX
   152 0000017F 53                              	PUSH	EBX
   153 00000180 E8 [00000000]                   	CALL	_init_mouse_cursor8
   154 00000185 6A 10                           	PUSH	16
   155 00000187 53                              	PUSH	EBX
   156 00000188 8D 5D C4                        	LEA	EBX,DWORD [-60+EBP]
   157 0000018B 57                              	PUSH	EDI
   158 0000018C 56                              	PUSH	ESI
   159 0000018D 6A 10                           	PUSH	16
   160 0000018F 6A 10                           	PUSH	16
   161 00000191 0F BF 05 00000FF4               	MOVSX	EAX,WORD [4084]
   162 00000198 50                              	PUSH	EAX
   163 00000199 FF 35 00000FF8                  	PUSH	DWORD [4088]
   164 0000019F E8 [00000000]                   	CALL	_putblock8_8
   165 000001A4 83 C4 28                        	ADD	ESP,40
   166 000001A7 57                              	PUSH	EDI
   167 000001A8 56                              	PUSH	ESI
   168 000001A9 68 [00000041]                   	PUSH	LC3
   169 000001AE 53                              	PUSH	EBX
   170 000001AF E8 [00000000]                   	CALL	_sprintf
   171 000001B4 53                              	PUSH	EBX
   172 000001B5 6A 01                           	PUSH	1
   173 000001B7 6A 64                           	PUSH	100
   174 000001B9 6A 10                           	PUSH	16
   175 000001BB 0F BF 05 00000FF4               	MOVSX	EAX,WORD [4084]
   176 000001C2 50                              	PUSH	EAX
   177 000001C3 FF 35 00000FF8                  	PUSH	DWORD [4088]
   178 000001C9 E8 [00000000]                   	CALL	_putfonts8_asc
   179 000001CE 8D 85 FFFFFE14                  	LEA	EAX,DWORD [-492+EBP]
   180 000001D4 83 C4 28                        	ADD	ESP,40
   181 000001D7 50                              	PUSH	EAX
   182 000001D8 E8 [00000000]                   	CALL	_enable_mouse
   183 000001DD 59                              	POP	ECX
   184 000001DE                                 L18:
   185 000001DE E8 [00000000]                   	CALL	_io_cli
   186 000001E3 68 [00000000]                   	PUSH	_keyfifo
   187 000001E8 E8 [00000000]                   	CALL	_fifo8_status
   188 000001ED 68 [00000000]                   	PUSH	_mousefifo
   189 000001F2 89 C3                           	MOV	EBX,EAX
   190 000001F4 E8 [00000000]                   	CALL	_fifo8_status
   191 000001F9 8D 04 18                        	LEA	EAX,DWORD [EAX+EBX*1]
   192 000001FC 5B                              	POP	EBX
   193 000001FD 5A                              	POP	EDX
   194 000001FE 85 C0                           	TEST	EAX,EAX
   195 00000200 0F 84 00000206                  	JE	L19
   196 00000206 68 [00000000]                   	PUSH	_keyfifo
   197 0000020B E8 [00000000]                   	CALL	_fifo8_status
   198 00000210 59                              	POP	ECX
   199 00000211 85 C0                           	TEST	EAX,EAX
   200 00000213 0F 85 00000191                  	JNE	L20
   201 00000219 68 [00000000]                   	PUSH	_mousefifo
   202 0000021E E8 [00000000]                   	CALL	_fifo8_status
   203 00000223 5A                              	POP	EDX
   204 00000224 85 C0                           	TEST	EAX,EAX
   205 00000226 74 B6                           	JE	L18
   206 00000228 68 [00000000]                   	PUSH	_mousefifo
   207 0000022D E8 [00000000]                   	CALL	_fifo8_get
   208 00000232 89 C3                           	MOV	EBX,EAX
   209 00000234 E8 [00000000]                   	CALL	_io_sti
   210 00000239 0F B6 C3                        	MOVZX	EAX,BL
   211 0000023C 50                              	PUSH	EAX
   212 0000023D 8D 85 FFFFFE14                  	LEA	EAX,DWORD [-492+EBP]
   213 00000243 50                              	PUSH	EAX
   214 00000244 E8 [00000000]                   	CALL	_mouse_decode
   215 00000249 83 C4 0C                        	ADD	ESP,12
   216 0000024C 85 C0                           	TEST	EAX,EAX
   217 0000024E 74 8E                           	JE	L18
   218 00000250 FF B5 FFFFFE1C                  	PUSH	DWORD [-484+EBP]
   219 00000256 FF B5 FFFFFE18                  	PUSH	DWORD [-488+EBP]
   220 0000025C 68 [00000049]                   	PUSH	LC5
   221 00000261 8D 5D C4                        	LEA	EBX,DWORD [-60+EBP]
   222 00000264 53                              	PUSH	EBX
   223 00000265 E8 [00000000]                   	CALL	_sprintf
   224 0000026A 83 C4 10                        	ADD	ESP,16
   225 0000026D 8B 85 FFFFFE20                  	MOV	EAX,DWORD [-480+EBP]
   226 00000273 A9 00000001                     	TEST	EAX,1
   227 00000278 74 04                           	JE	L11
   228 0000027A C6 45 C5 4C                     	MOV	BYTE [-59+EBP],76
   229 0000027E                                 L11:
   230 0000027E A9 00000002                     	TEST	EAX,2
   231 00000283 74 04                           	JE	L12
   232 00000285 C6 45 C7 52                     	MOV	BYTE [-57+EBP],82
   233 00000289                                 L12:
   234 00000289 83 E0 04                        	AND	EAX,4
   235 0000028C 74 04                           	JE	L13
   236 0000028E C6 45 C6 43                     	MOV	BYTE [-58+EBP],67
   237 00000292                                 L13:
   238 00000292 6A 2F                           	PUSH	47
   239 00000294 68 00000097                     	PUSH	151
   240 00000299 6A 20                           	PUSH	32
   241 0000029B 6A 20                           	PUSH	32
   242 0000029D 6A 0E                           	PUSH	14
   243 0000029F 0F BF 05 00000FF4               	MOVSX	EAX,WORD [4084]
   244 000002A6 50                              	PUSH	EAX
   245 000002A7 FF 35 00000FF8                  	PUSH	DWORD [4088]
   246 000002AD E8 [00000000]                   	CALL	_boxfill8
   247 000002B2 53                              	PUSH	EBX
   248 000002B3 6A 07                           	PUSH	7
   249 000002B5 6A 20                           	PUSH	32
   250 000002B7 6A 20                           	PUSH	32
   251 000002B9 0F BF 05 00000FF4               	MOVSX	EAX,WORD [4084]
   252 000002C0 50                              	PUSH	EAX
   253 000002C1 FF 35 00000FF8                  	PUSH	DWORD [4088]
   254 000002C7 E8 [00000000]                   	CALL	_putfonts8_asc
   255 000002CC 8D 47 0F                        	LEA	EAX,DWORD [15+EDI]
   256 000002CF 83 C4 34                        	ADD	ESP,52
   257 000002D2 50                              	PUSH	EAX
   258 000002D3 8D 46 0F                        	LEA	EAX,DWORD [15+ESI]
   259 000002D6 50                              	PUSH	EAX
   260 000002D7 57                              	PUSH	EDI
   261 000002D8 56                              	PUSH	ESI
   262 000002D9 6A 0E                           	PUSH	14
   263 000002DB 0F BF 05 00000FF4               	MOVSX	EAX,WORD [4084]
   264 000002E2 50                              	PUSH	EAX
   265 000002E3 FF 35 00000FF8                  	PUSH	DWORD [4088]
   266 000002E9 E8 [00000000]                   	CALL	_boxfill8
   267 000002EE 83 C4 1C                        	ADD	ESP,28
   268 000002F1 03 BD FFFFFE1C                  	ADD	EDI,DWORD [-484+EBP]
   269 000002F7 03 B5 FFFFFE18                  	ADD	ESI,DWORD [-488+EBP]
   270 000002FD 0F 88 000000A0                  	JS	L21
   271 00000303                                 L14:
   272 00000303 85 FF                           	TEST	EDI,EDI
   273 00000305 0F 88 00000091                  	JS	L22
   274 0000030B                                 L15:
   275 0000030B 0F BF 05 00000FF4               	MOVSX	EAX,WORD [4084]
   276 00000312 83 E8 10                        	SUB	EAX,16
   277 00000315 39 C6                           	CMP	ESI,EAX
   278 00000317 7E 02                           	JLE	L16
   279 00000319 89 C6                           	MOV	ESI,EAX
   280 0000031B                                 L16:
   281 0000031B 0F BF 05 00000FF6               	MOVSX	EAX,WORD [4086]
   282 00000322 83 E8 10                        	SUB	EAX,16
   283 00000325 39 C7                           	CMP	EDI,EAX
   284 00000327 7E 02                           	JLE	L17
   285 00000329 89 C7                           	MOV	EDI,EAX
   286 0000032B                                 L17:
   287 0000032B 57                              	PUSH	EDI
   288 0000032C 56                              	PUSH	ESI
   289 0000032D 68 [00000057]                   	PUSH	LC6
   290 00000332 53                              	PUSH	EBX
   291 00000333 E8 [00000000]                   	CALL	_sprintf
   292 00000338 6A 0F                           	PUSH	15
   293 0000033A 6A 4F                           	PUSH	79
   294 0000033C 6A 00                           	PUSH	0
   295 0000033E 6A 00                           	PUSH	0
   296 00000340 6A 0E                           	PUSH	14
   297 00000342 0F BF 05 00000FF4               	MOVSX	EAX,WORD [4084]
   298 00000349 50                              	PUSH	EAX
   299 0000034A FF 35 00000FF8                  	PUSH	DWORD [4088]
   300 00000350 E8 [00000000]                   	CALL	_boxfill8
   301 00000355 83 C4 2C                        	ADD	ESP,44
   302 00000358 53                              	PUSH	EBX
   303 00000359 6A 07                           	PUSH	7
   304 0000035B 6A 00                           	PUSH	0
   305 0000035D 6A 00                           	PUSH	0
   306 0000035F 0F BF 05 00000FF4               	MOVSX	EAX,WORD [4084]
   307 00000366 50                              	PUSH	EAX
   308 00000367 FF 35 00000FF8                  	PUSH	DWORD [4088]
   309 0000036D E8 [00000000]                   	CALL	_putfonts8_asc
   310 00000372 8D 85 FFFFFEC4                  	LEA	EAX,DWORD [-316+EBP]
   311 00000378 6A 10                           	PUSH	16
   312 0000037A 50                              	PUSH	EAX
   313 0000037B 57                              	PUSH	EDI
   314 0000037C 56                              	PUSH	ESI
   315 0000037D 6A 10                           	PUSH	16
   316 0000037F 6A 10                           	PUSH	16
   317 00000381 0F BF 05 00000FF4               	MOVSX	EAX,WORD [4084]
   318 00000388 50                              	PUSH	EAX
   319 00000389 FF 35 00000FF8                  	PUSH	DWORD [4088]
   320 0000038F E8 [00000000]                   	CALL	_putblock8_8
   321 00000394 83 C4 38                        	ADD	ESP,56
   322 00000397 E9 FFFFFE42                     	JMP	L18
   323 0000039C                                 L22:
   324 0000039C 31 FF                           	XOR	EDI,EDI
   325 0000039E E9 FFFFFF68                     	JMP	L15
   326 000003A3                                 L21:
   327 000003A3 31 F6                           	XOR	ESI,ESI
   328 000003A5 E9 FFFFFF59                     	JMP	L14
   329 000003AA                                 L20:
   330 000003AA 68 [00000000]                   	PUSH	_keyfifo
   331 000003AF E8 [00000000]                   	CALL	_fifo8_get
   332 000003B4 89 C3                           	MOV	EBX,EAX
   333 000003B6 E8 [00000000]                   	CALL	_io_sti
   334 000003BB 53                              	PUSH	EBX
   335 000003BC 8D 5D C4                        	LEA	EBX,DWORD [-60+EBP]
   336 000003BF 68 [00000062]                   	PUSH	LC4
   337 000003C4 53                              	PUSH	EBX
   338 000003C5 E8 [00000000]                   	CALL	_sprintf
   339 000003CA 6A 2F                           	PUSH	47
   340 000003CC 6A 0F                           	PUSH	15
   341 000003CE 6A 20                           	PUSH	32
   342 000003D0 6A 00                           	PUSH	0
   343 000003D2 6A 0E                           	PUSH	14
   344 000003D4 0F BF 05 00000FF4               	MOVSX	EAX,WORD [4084]
   345 000003DB 50                              	PUSH	EAX
   346 000003DC FF 35 00000FF8                  	PUSH	DWORD [4088]
   347 000003E2 E8 [00000000]                   	CALL	_boxfill8
   348 000003E7 83 C4 2C                        	ADD	ESP,44
   349 000003EA 53                              	PUSH	EBX
   350 000003EB 6A 07                           	PUSH	7
   351 000003ED 6A 20                           	PUSH	32
   352 000003EF 6A 00                           	PUSH	0
   353 000003F1 0F BF 05 00000FF4               	MOVSX	EAX,WORD [4084]
   354 000003F8 50                              	PUSH	EAX
   355 000003F9 FF 35 00000FF8                  	PUSH	DWORD [4088]
   356 000003FF E8 [00000000]                   	CALL	_putfonts8_asc
   357 00000404 83 C4 18                        	ADD	ESP,24
   358 00000407 E9 FFFFFDD2                     	JMP	L18
   359 0000040C                                 L19:
   360 0000040C E8 [00000000]                   	CALL	_io_stihlt
   361 00000411 E9 FFFFFDC8                     	JMP	L18
